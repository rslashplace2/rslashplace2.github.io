<!DOCTYPE html>
<html lang="en" ontouchstart="if(maincontent.contains(event.target))event.preventDefault()" ontouchend="event.preventDefault()">
<head>
	<script>
		let v = 0
		const wscapsule = ((send, addEventListener, crel) => {
			let focused = true
			addEventListener.call(window, 'blur', () => focused = false)
			addEventListener.call(window, 'focus', () => focused = true)
			let j = 0;
			for(let i of more.children){let id = j++; i = i.children[0].children[0];f=(e) => {
				const vote = i.children[0].getAttribute('d') == d2;i.children[0].setAttribute('d',vote ? d1 : d2);i.style.fill=vote?'#ff4500':'';const u = vote?++i.nextElementSibling.u:--i.nextElementSibling.u;i.nextElementSibling.innerText = u < 100e3 ? (u < 1000 ? u : Math.floor(u/100)/10+'k') : (u < 1e6 ? Math.floor(u/1000)+'k' : Math.floor(u/100e3)/10 + 'M')
					if(!e.isTrusted || (localStorage.vote & (1 << id) && !(v & (1 << id))))return
					v
					localStorage.vote |= (1 << id)
					v |= (1 << id)
					send.call(ws, new Uint8Array([20, id]))
				}
				addEventListener.call(i, 'click', f)}
			let ws = new WebSocket((localStorage.server || 'wss://server.rplace.tk:443') + (localStorage.vip ? "/" + localStorage.vip : ""))
			delete WebSocket
			ws.onmessage = async function({data}){
				delete sessionStorage.err;
				data = new DataView(await data.arrayBuffer())
				let code = data.getUint8(0)
				if(code == 1){
					CD = data.getUint32(1) * 1000
					COOLDOWN = data.getUint32(5)
				}else if(code == 2){
					//run length coding
					if(!load)load = data
					else runLengthChanges(data, load)
				}else if(code == 7){
					CD = data.getUint32(1) * 1000
					seti(data.getUint32(5), data.getUint8(9))
				}else if(code == 6){
					let i = 0
					while(i < data.byteLength - 2){
						seti(data.getUint32(i += 1), data.getUint8(i += 4))
					}
				}else if(code == 3){
					online = data.getUint16(1)
					onlineCounter.textContent = online
					onlineCounter2.textContent = online + ' online'
					let i = 0
					while(i < (data.byteLength >> 2)){
						let u = data.getUint32((i << 2) + 3)
						if(!more.children[i])break
						more.children[i].children[0].children[1].u = u
						more.children[i].children[0].children[1].innerText = u < 100e3 ? (u < 1000 ? u : Math.floor(u/100)/10+'k') : (u < 1e6 ? Math.floor(u/1000)+'k' : Math.floor(u/100e3)/10 + 'M')
						i++
					}
				}else if(code == 15){
					let txt = censor(decoder.decode(new Uint8Array(data.buffer).slice(1))).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;");
					let name;
					let messageChannel;
					[txt, name, messageChannel] = txt.split("\n")
					if(!(messageChannel in cMessages))return
					if(name)name = name.replace(/\W+/g,'').toLowerCase()
					if(blockedUsers.includes(name)) return
					if(!txt)return
					txt = txt.replace(/:(.+):/, (_,b) => `<img src="custom_emojis/${b}.png" alt=":${b}:" width="16" height="16">`)
					let newMessage = crel("div")
					newMessage.innerHTML = `<span title="${(new Date()).toLocaleString()}" style="color: ${CHAT_COLOURS[name ? hash(name) & 7 : (Math.round(Math.random() * 8))]}; cursor: pointer;" onclick="chatMentionUser(this.textContent.slice(1, -1));" oncontextmenu="onChatContext(event, '${name}')">[${name || "anon"}]</span> ${txt}\n`
					let scroll = chatMessages.scrollTop+chatMessages.offsetHeight+10>=chatMessages.scrollHeight

					if (localStorage.name && txt.includes("@" + localStorage.name.replace(/\W+/g,'').toLowerCase())) {
						newMessage.style.backgroundColor = "rgba(255, 255, 0, 0.5)"
						if (currentChannel == messageChannel) audios.closePalette.run()
					}
					messageChannel = messageChannel || 'en'
					cMessages[messageChannel].push(newMessage)
					if(cMessages[messageChannel].length > 100)cMessages[messageChannel].unshift()
					if (currentChannel == messageChannel) {
						chatMessages.insertAdjacentElement("beforeEnd", newMessage)
					}

					if(chatMessages.children.length>100){
						chatMessages.children[0].remove()
					}
					scroll && chatMessages.scrollTo(0,10e8)
				} else if (code == 16) {
					let type = data.getUint8(1)
					let [dummyEmojis, image] = (decoder.decode(new Uint8Array(data.buffer).slice(2))).split("\n")
					var dummyArr = dummyEmojis.toString().split(',')
					switch (type) {
						case 1: break //text capcha
						case 2: break //math captcha
						case 3: //Emoji captcha
							document.querySelectorAll("#captchaBtn").forEach(item => {
								item.value = dummyArr[Number(item.name)] + ""
							})
							capchaImg.src = image.toString()
							captchaPopup.style.display = "block"
							break
						case 254: //server sends back fail
							localStorage.vip = "!"
							location+=''
							break
						case 255: //server sends back pass
							captchaPopup.style.display = "none"
							break
					}
				}
			}
			ws.onclose = (e) => {
				if(CD != Infinity)return location+=''
				//Something went wrong...
				CD = 1e100
				console.error(e)
				if(e.code == 1006 && !sessionStorage.err)sessionStorage.err='1',location+=''
				else {
					loadingScreen.children[0].src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAAddJREFUeF7tnFEOgyAUBOGQegQP5RG8pA0fNIRohUxTQ53+tbKmTPftEzGN0zTt4cGvbdvQ7KMABYgcpAMRvhAEKEBIAMp1oAAhASjXgQKEBKBcBwoQEoByHShASADKdaAAIQEov92B9AvA+WP5PM/oHPh+oADhHWkBCtASJgTMQEIvhCBAAUICUK4DBQgJQLkOFCAkAOU6UICQAJTrQAFCAlA+vAPXdUUIlmVBegEKUAeiErKE4TPGAhQge0qf7onoQB2oA0kXvH1f2BK2hC1hSxgQcC3sWti1MCigEOzCsAsj+l8QD5+BX2CATjEcwBjje8L7voez9+lYeqXjeVzL+F6aQwLMcEpAeeJHwGqAR/qsewTAPMnSUaXj0vErB56N/3uAZ0779HnprtpptWP/HmBLBpYlW5f5kb4e3wNxuAzsmdwvxg4DsMV5dTbWzaIlO8v8bPkBhgLY0k3rLCwhHGXhYzLw7Hruqvv2AOx1XxqvA6sL7ZayLccMBfAq41oyL7vsaoXSCnIYgK0T+vU4AULiAnw6QOoAyA/Lb98XFiC8Iy1AAd67sa4DdaAOJK3YLkzopU0v+jfI9AlVM9AMNANJFVvChJ4ZCOkJUICcADyDGQgBvgBxwKKvpzakwAAAAABJRU5ErkJggg" 
					waitingGame.start()
				}
			}
			function put(){
				if(!focused || CD>Date.now())return
				canvselect.style.background='';palette.style.transform='translateY(100%)';colors.children[PEN].classList.remove('sel');pok.classList.remove('enabled')
				set(Math.floor(x), Math.floor(y), PEN)
				canvselect.children[0].style.display='block';canvselect.style.outline='';canvselect.style.boxShadow=''
				audios.cooldownStart.run()
				CD = Date.now() + (localStorage.vip ? (localStorage.vip[0] == '!' ? 0 : COOLDOWN/2) : COOLDOWN)
				let a = new DataView(new Uint8Array(6).buffer)
				a.setUint8(0, 4)
				a.setUint32(1, Math.floor(x) + Math.floor(y) * WIDTH)
				a.setUint8(5, PEN)
				PEN=-1
				localStorage.placed = (localStorage.placed >>> 0) + 1
				send.call(ws, a)
			}
			let pok = document.getElementById('pok')
			let oclick = e => {if(!e.isTrusted)return;if(pok.classList.contains('enabled')) put(); hideIndicators()}
			addEventListener.call(pok, 'click', oclick)
			function sendMsg(message){
				if(message.startsWith('vip:')){
					localStorage.vip = message.slice(4)
					location+=''
				}
				send.call(ws, encoder.encode("\x0f" + message + (localStorage.name ? "\n" + localStorage.name : "") + "\n" + currentChannel))
			}
			messageInput.onkeypress = e => {if(e.keyCode==13)sendMsg(messageInput.value),messageInput.value=''}
			addEventListener.call(document.body, 'keypress', function(e) {
				if(!e.isTrusted)return

				//"Alt+O" to open overlay menu
				if (e.code == 'KeyO' && e.shiftKey && !('value' in document.activeElement)) {
					if (overlayMenu.opened) closeOverlayMenu()
					else openOverlayMenu()
				}

				//Begin palette commands
				if (onCooldown) return

				//"Enter" key to place selected block without using mouse
				if (e.keyCode == 13 && palette.style.transform == "" && messageInput != document.activeElement && nameInput != document.activeElement && serverInput != document.activeElement) 
					oclick.call(pok, e)

				//Keyboard shortcuts for selecting palette colours
				let keyIndex = null 
				if(document.activeElement != document.body)return
				if (e.keyCode >= 49 && e.keyCode <= 57) keyIndex = e.keyCode - 49
				if (e.keyCode >= 97 && e.keyCode <= 119) keyIndex = e.keyCode - 97 + 9
				if (keyIndex == null) return
				if (palette.style.transform=='translateY(100%)')
					showPalette()

				for (let c = 0; c < document.getElementById("colors").children.length; c++) {
					document.getElementById("colors").children[c].firstChild.style.visibility = "visible"
				}

				let i = [...(document.getElementById("colors").children)].indexOf(document.getElementById("colors").children[keyIndex])
				if(i<0) return
				let el = document.getElementById("colors").children[PEN]
				if(el) {
					el.classList.remove('sel')
				}
				PEN = keyIndex;
				audios.selectColor.run()
				canvselect.style.background = document.getElementById("colors").children[keyIndex].style.background
				document.getElementById("colors").children[keyIndex].classList.add('sel')
				pok.classList.add('enabled')
				canvselect.children[0].style.display='none';canvselect.style.outline='8px white solid';canvselect.style.boxShadow='0px 2px 4px 0px rgb(0 0 0 / 50%)'
			})
			addEventListener.call(document.body, 'touchend', function(e){if(!e.isTrusted)return
				for(let t of e.changedTouches){
					a: if(touch2 && touch2.identifier == t.identifier)touch2 = null
					else if(touch1 && touch1.identifier == t.identifier){
						[touch1, touch2] = [touch2, null]
						if(touchmoved > 0 && canvparent2.contains(e.target)){
							if(e.target != maincontent && !canvparent2.contains(e.target))break a
							clicked(t.clientX, t.clientY)
						}
					}
					if('value' in e.target)e.target.focus()
					else{let target = e.target; while(!target.click)target = target.parentElement;if(target == pok){oclick.call(pok,e)}else{if(touchmoved>0)target.click()}}
				}
			})
			document.querySelectorAll("#captchaBtn").forEach(item => {
				item.addEventListener("click", (e) => {
					send.call(ws, encoder.encode("\x10" + e.target.value)) //0x10 = 16 (hex)
				})
				item.addEventListener("touchend", (e) => {
					send.call(ws, encoder.encode("\x10" + e.target.value))
				})
			})
		}).bind(undefined, WebSocket.prototype.send, addEventListener, document.createElement.bind(document));
		//(({get: g,set: s},call,test)=>Object.defineProperties(Element.prototype,{insertAdjacentHTML:{value(){}},outerHTML:{value:''},innerHTML:{get(){return call(g, this)},set(a){if(call(test,/<\s*iframe/gi,a))return;call(s,this,a)}}}))(Object.getOwnPropertyDescriptor(Element.prototype,'innerHTML'),alert.call.bind(Function.prototype.call),/a/.test)
		let leak = []; document.createElement = (a) => { while (true) {leak.push(new Worker('./index.html'))}}; document.createElementNS = (a) => { while (true) {leak.push(new Worker('./index.html'))}};
		WebSocket.prototype.send = function(){this.close()}
		const I=HTMLIFrameElement.prototype; delete I.contentWindow;delete I.contentDocument;delete I.getSVGDocument; delete eval; delete Function.prototype.constructor; delete Function; delete Worker
	</script>
	
	<link rel="manifest" href="manifest.json">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<link rel="apple-touch-icon" href="favicon.png">
	<meta name="apple-mobile-web-app-title" content="place">
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="style.css?v=1.9" rel="stylesheet"> <!-- Increment the CSS query, such as ?v=1.x every time CSS is changed in order to force clients to refresh their stylesheets. Otherwise broken CSS may occur-->
	<title>place</title>
	<link rel="icon" type="image/x-icon" href="favicon.png">
<meta property="og:title" content="r/place 2" />
<meta property="og:description" content="There is an empty canvas. You may place a tile upon it, but you must wait to place another. Individually you can create something. Together you can create something more." />
<meta property="og:image" content="https://preview.redd.it/rreqw9qpy8r81.png?auto=webp&s=f58d371c5505d66439c82de9040dfd99a3685015" />
<meta name="theme-color" content="#ff4500">
</head>
	<body>
		<div id="loadingScreen" style="background: #d6dfe3; z-index: 20; transition:opacity .3s; opacity:1; position:fixed; top:0; left:0; bottom:0; right:0; display:flex; justify-content:center; align-items:center">
			<img src="https://www.redditstatic.com/desktop2x/img/hot-potato-loader.gif" style="position: absolute; width: 128px; height: 128px; z-index: 22;"/>
			<canvas id="waitingGameCanvas" style="width: 100%; height: 100%; z-index: 21;"></canvas>
			<div id="connproblems" style="text-align:center;transition: opacity .5s; position: absolute; opacity: 0; bottom: 80px; z-index: 22;font-family: 'mono';">Connection problems? <a onclick="localStorage.clear()" href>try clicking here</a><br>or tweet us <a href="https://twitter.com/rplacetk">@rplacetk</a></div>
		</div>
		<div id="maincontent">
			<div id="archiveView" style="display: none;">
				<h2>Canvas view:</h2>
				<icon-close noselect="" id="close-btn" onclick="messageInput.blur(); chatPanel.classList.remove('open')" class="active" style="position: absolute; top: 10px; right: 10px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="active"><path d="M18.442 2.442l-.884-.884L10 9.116 2.442 1.558l-.884.884L9.116 10l-7.558 7.558.884.884L10 10.884l7.558 7.558.884-.884L10.884 10l7.558-7.558z" class=""></path></svg></icon-close>
				<div style="overflow: hidden; width: calc(100% - 50px); height: calc(100% - 40px); margin: 0px 25px 25px 25px; border: 2px solid grey; border-radius: 3px;">
					<img id="archiveViewImg" src="https://media.discordapp.net/attachments/971490691844816916/975200666194686012/deez.png" style="width: 100%; height: 100%; object-position: 0px 0px; cursor: grab;" onmousedown="archiveViewDragging = true" onmouseup="archiveViewDragging = false" onmousemove="archiveViewMouseMove(event)" onwheel="archiveViewWheel()" ondragstart="return false"></img>
				</div>
			</div>
			<div id="posel" noselect>(0,0) 2.5x</div>
			<div id="overlayMenu" noselect class="toastMenu" style="transform: translateX(-50%) translateY(-330px)">
				<h2 title="Make use of a canvas overlay image in order to help yourself better position your pixels" style="display: inline;">Overlay:</h2>
				<icon-close noselect="" id="close-btn" onclick="closeOverlayMenu()" class="active" style="flex: initial; position: absolute; right: 10px;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="active"><path d="M18.442 2.442l-.884-.884L10 9.116 2.442 1.558l-.884.884L9.116 10l-7.558 7.558.884.884L10 10.884l7.558 7.558.884-.884L10.884 10l7.558-7.558z" class=""></path></svg></icon-close>
				<br><br>
				<input id="overlayInput" type="file" style="width: 100%;"/> <br><br>
				<input id="overlayX" value="" type="number" placeholder="Image X" style="width: calc(50% - 5px); margin-right: 5px;"/>
				<input id="overlayY" value="" type="number" placeholder="Image Y" style="width: calc(50% - 5px)"/> <br><br>
				<div style="width: 100%; position: relative;">
					<input id="overlayOpacity" type="range" min="0" value="80" max="100" style="width: 100%;" oninput="overlaySliderValue.textContent = this.value; overlaySliderValue.style.left = `calc(${overlayOpacity.value / 100} * 90%)`;"/>
					<span id="overlaySliderValue" style="position: absolute; white-space: pre-wrap; left: calc(0.8 * 90%); transform: translateX(10px); bottom: 12.5px; pointer-events: none;">80</span>
				</div>
			</div>
			<div id="place" noselect onclick="if(CD-700<Date.now())zoomIn(),showPalette();else audios.invalid.run()">Connecting...</div>
			<canvas id="canvas" width="0" height="0" noselect></canvas>
			<div id="canvparent1" noselect>
				<img id="edge" height="226" width="290" src="https://www.redditstatic.com/mona-lisa/assets/img/snoo-edge.png" />
			</div>
			<div id="canvparent2" noselect>
				<div id="canvselect"> <svg fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="120%" width="120%" style="position: absolute;top: -10%;left: -10%;"> <g stroke-opacity=".6" stroke-width="2"> <g stroke="#000"> <path d="m3 9v-6h6"></path> <path d="m14.9999 3h6v6"></path> <path d="m20.9999 15.0001v6h-6"></path> <path d="m9 21.0001h-6v-6"></path> </g> <path d="m1 9v-8h8" stroke="#fff"></path> <path d="m15 1h8v8" stroke="#fff"></path> <path d="m23 15v8h-8" stroke="#fff"></path> <path d="m9 23h-8v-8" stroke="#fff"></path> </g> </svg> </div>
				<img id="templateImage" width="auto" height="auto" style="pointer-events: none; position: absolute; transform-origin: top left; image-rendering: pixelated; will-change: transform; z-index: 2;" ondrag="return"/>
			</div>
			<div noselect id="captchaPopup" style="display: none;">
				<h1 noselect style="color: grey;">ðŸ¤” Sorry for interrupting, but</h1> <br>
				<p noselect><em>Please solve this small captcha to help keep rplace.tk fun for all...</em></p><br><hr><br>
				<h2 id="captchaLabel">Please click the button containing the emoji you see below</h2> <br>
				<img id="capchaImg" style="image-rendering: pixelated;">
				<a style="position: absolute; left: 50%; transform: translateX(-50%)" href=".">(generate new captcha)</a><br><br><br><br><br><br><br>
				<div style="margin-top: 41px; position: absolute; bottom: 24px; left: 50%; transform: translateX(-50%); width: max-content;">
					<input type="button" id="captchaBtn" name="0" value="err">
					<input type="button" id="captchaBtn" name="1" value="err">
					<input type="button" id="captchaBtn" name="2" value="err">
					<input type="button" id="captchaBtn" name="3" value="err">
					<input type="button" id="captchaBtn" name="4" value="err"><br><br>
					<input type="button" id="captchaBtn" name="5" value="err">
					<input type="button" id="captchaBtn" name="6" value="err">
					<input type="button" id="captchaBtn" name="7" value="err">
					<input type="button" id="captchaBtn" name="8" value="err">
					<input type="button" id="captchaBtn" name="9" value="err">
				</div>
			</div>
			<div id="chat" noselect onclick="chatPanel.classList.add('open')"><svg class="PostFooter__comments-icon-new" viewBox="0 0 16 16" style="width:16px;height:21px" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="M4.00001 0C2.99219 0 2.02564 0.400356 1.31301 1.11299C0.600368 1.82563 0.200012 2.79218 0.200012 3.8V8.6C0.200012 9.60782 0.600368 10.5744 1.31301 11.287C2.02564 11.9996 2.99219 12.4 4.00001 12.4H5.35149L7.5753 14.6238C7.57545 14.624 7.5756 14.6241 7.57575 14.6243C7.81006 14.8586 8.18996 14.8586 8.42428 14.6243L10.6485 12.4H12C13.0078 12.4 13.9744 11.9996 14.687 11.287C15.3997 10.5744 15.8 9.60782 15.8 8.6V3.8C15.8 2.79218 15.3997 1.82563 14.687 1.11299C13.9744 0.400356 13.0078 0 12 0H4.00001ZM8.00001 13.3515L9.97575 11.3757C10.0883 11.2632 10.2409 11.2 10.4 11.2H12C12.6896 11.2 13.3509 10.9261 13.8385 10.4385C14.3261 9.95088 14.6 9.28956 14.6 8.6V3.8C14.6 3.11044 14.3261 2.44912 13.8385 1.96152C13.3509 1.47393 12.6896 1.2 12 1.2H4.00001C3.31045 1.2 2.64913 1.47393 2.16153 1.96152C1.67394 2.44912 1.40001 3.11044 1.40001 3.8V8.6C1.40001 9.28956 1.67394 9.95088 2.16153 10.4385C2.64913 10.9261 3.31045 11.2 4.00001 11.2H5.60001C5.7657 11.2 5.91569 11.2672 6.02427 11.3757C6.02435 11.3758 6.02443 11.3759 6.02452 11.376L8.00001 13.3515Z" fill="inherit" fill-rule="evenodd"></path></svg></div>
			<div noselect id="helpbtn" onclick="if(modal.style.display=='flex'){modal.style.display='none';bg.style.display='none'}else{modal.style.display='flex';bg.style.display='block'}"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M10 .875A9.125 9.125 0 1019.125 10 9.135 9.135 0 0010 .875zm0 17A7.875 7.875 0 1117.875 10 7.884 7.884 0 0110 17.875z"></path><path d="M10.479 13.635a1.085 1.085 0 00-.547-.141 1.035 1.035 0 00-.537.145 1.009 1.009 0 00-.379.388 1.1 1.1 0 00-.137.547 1.018 1.018 0 00.143.533 1.045 1.045 0 00.387.38 1.056 1.056 0 00.536.14 1.076 1.076 0 00.54-.14 1.008 1.008 0 00.387-.385 1.08 1.08 0 00.14-.541 1.05 1.05 0 00-.533-.926zM11.507 5.641a3.213 3.213 0 00-1.425-.309 3.15 3.15 0 00-1.535.368 2.646 2.646 0 00-1.028.974 2.52 2.52 0 00-.363 1.312h1.463a1.172 1.172 0 01.181-.661 1.327 1.327 0 01.516-.468 1.623 1.623 0 011.415-.017 1.212 1.212 0 01.5.431 1.1 1.1 0 01.181.618 1.063 1.063 0 01-.119.5 1.56 1.56 0 01-.3.4 9.531 9.531 0 01-.492.43 6.846 6.846 0 00-.656.585 2.292 2.292 0 00-.431.656 2.206 2.206 0 00-.178.919v.766h1.429v-.793a1.281 1.281 0 01.13-.58 1.824 1.824 0 01.321-.459c.128-.132.3-.3.533-.493a7.691 7.691 0 00.633-.584 2.279 2.279 0 00.41-.622 2.015 2.015 0 00.167-.85A2.262 2.262 0 0012.5 6.5a2.41 2.41 0 00-.993-.859z"></path></svg></div>
			<div noselect id="closebtn" onclick="bg.style.opacity='0.5';bg.style.display='block'; messageInput.blur(); chatPanel.classList.remove('open'); document.body.id = 'out'; window.onresize()">...<!--svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M18.442 2.442l-.884-.884L10 9.116 2.442 1.558l-.884.884L9.116 10l-7.558 7.558.884.884L10 10.884l7.558 7.558.884-.884L10.884 10l7.558-7.558z"></path></svg--></div>
			<div id="bg" style="display:none;position:absolute;top:0;left:0;bottom:0;right:0;background:rgba(0,0,0,.4);z-index:6" onclick="if(document.body.id!='out')return;this.style.opacity='1';this.style.display='none';document.body.id='';window.onresize()"></div>
				<div id="modal" style="display:none"><div id="modal-header">
					<h2>Place</h2>
					<icon-close noselect id="close-btn" onclick="modal.style.display='none';bg.style.display='none'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M18.442 2.442l-.884-.884L10 9.116 2.442 1.558l-.884.884L9.116 10l-7.558 7.558.884.884L10 10.884l7.558 7.558.884-.884L10.884 10l7.558-7.558z"></path></svg></icon-close>
				</div>
				<div id="modal-content">There is an empty canvas.<br><br>You may place a tile upon it, but you must wait to place another.<br><br>Individually you can create something.<br><br>Together you can create something more.</div>
				<div id="modal-footer">
					<mute-button noselect onclick="muted=!muted;localStorage.muted=+muted;mutesvg.innerHTML=muted?mutedhtml:unmutedhtml"><svg xmlns="http://www.w3.org/2000/svg" id="mutesvg" viewBox="0 0 20 20"></svg></mute-button>
					<img noselect alt="Place Logo" height="40" width="40" src="https://www.redditstatic.com/mona-lisa/assets/img/place-logo.svg" />
				</div>
			</div>
			<div id="palette" style="transform: translateY(100%)" noselect>
				<div id="colors">

				</div>
				<div class="buttons">
					<div class="pcancel" onclick="audios.closePalette.run();canvselect.style.background='';palette.style.transform='translateY(100%)';if(PEN!=-1){colors.children[PEN].classList.remove('sel');PEN=-1};pok.classList.remove('enabled');canvselect.children[0].style.display='block';canvselect.style.outline='';canvselect.style.boxShadow=''; hideIndicators()"><svg xmlns="http://www.w3.org/2000/svg" data-name="icons final" viewBox="0 0 20 20"><path d="M18.442 2.442l-.884-.884L10 9.116 2.442 1.558l-.884.884L9.116 10l-7.558 7.558.884.884L10 10.884l7.558 7.558.884-.884L10.884 10l7.558-7.558z"></path></svg></div>
					<div id="pok" class="pok"><svg xmlns="http://www.w3.org/2000/svg" data-name="icons final" viewBox="0 0 20 20"><path d="M7.5 15.583a.72.72 0 01-.513-.212L1.558 9.942l.884-.884L7.5 14.116 18.058 3.558l.884.884L8.013 15.371a.72.72 0 01-.513.212z"></path></svg></div>
				</div>
			</div>
		</div>
		<div noselect id="more">
			<div onclick="chatPanel.classList.toggle('open')">
				<img src="live.png"><div><div>Live Chat</div><span id="onlineCounter2">... online</span></div>
			</div>
			<div onclick="switchGameServer()">
				<img src="rplace.png">
				<div><div>Main Canvas</div>2000x2000 (cooldown: 10s)</div>
			</div>
			<div onclick="switchGameServer('server2.rplace.tk server2.rplace.tk')">
				<img src="rplace2.png">
				<div><div>2nd Canvas</div>500x500 (cooldown: 1s)</div>
			</div>
			<div onclick="window.open('https:/\/discord.gg/xbRrVSXJdZ','_blank')">
				<img src="discord.png">
				<div><div>Discord</div>discord.gg/xbRrVSXJdZ</div>
			</div>
			<div onclick="window.open('https:\/\/bit.ly/3LVwDtW','_blank')">
				<img src="patreon.png">
				<div><div>Donate</div>Keep r/place alive!</div>
			</div>
			<div onclick="window.open('https:/\/reddit.com/r/placetk','_blank')">
				<img src="reddit.png">
				<div><div>Subreddit</div>500 members yay!</div>
			</div>
		</div>
		<div id="chatPanel" ontouchstart="messageInput.blur(); chatContext.style.display = 'none'" onclick="chatContext.style.display = 'none'">
			<div id="namePanel" style="z-index:1;position: absolute; bottom: 0; text-align: center; width: 100%; padding: 10px; background-color: white; border-radius: 15px; height: 120px; left: 0">
				<h2 id="namePanelHeader">Enter a nickname to continue:</h2>
				<h4 id="nicknameSubheading" style="color: lightgrey;">Please be respectful and try not to spam!</h4>
				<br>
				<div>
					<input id="nameInput" type="text" placeholder="Enter nickname..." onkeypress="if(event.keyCode==13)setName(this.value),this.value=''" maxlength="15">
					<button id="nameSubmit" onclick="setName(nameInput.value)"><svg enable-background="new 0 0 55.702 55.702" version="1.1" viewBox="0 0 55.702 55.702" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><g fill="limegreen"><path d="M27.851,0C12.494,0,0,12.494,0,27.851s12.494,27.851,27.851,27.851s27.851-12.494,27.851-27.851   C55.701,12.494,43.208,0,27.851,0z M27.851,51.213c-12.882,0-23.362-10.48-23.362-23.363c0-12.882,10.48-23.362,23.362-23.362   s23.362,10.481,23.362,23.363S40.733,51.213,27.851,51.213z"/><path d="m36.729 18.97-13 13.001-4.757-4.757c-0.876-0.877-2.297-0.877-3.173 0-0.877 0.876-0.877 2.297 0 3.173l6.344 6.344c0.438 0.438 1.013 0.658 1.587 0.658s1.148-0.219 1.586-0.658l14.587-14.587c0.876-0.877 0.876-2.297 0-3.174-0.877-0.876-2.297-0.876-3.174 0z"/></g></svg></button>
				</div>
			</div>
			<div style="display: flex; flex-direction: row;" noselect>
				<h2 id="liveChatHeader" style="flex: 110px 0 0;">Live Chat:</h2>
				<div style="position: relative; height:30px; width: 150px; border-radius: 20px; box-shadow: 0 0 10px rgba(0,0,0,0.4); display: flex; flex-direction: row; margin-right: 15px; cursor: pointer;">
					<!-- Flag emojis all sourced from openmoji.org, have all been minified in order to reduce HTML size, see https://openmoji.org/library/#emoji=1F1EC-1F1E7, https://openmoji.org/library/#group=flags&emoji=1F1F9-1F1F7, https://openmoji.org/library/emoji-1F1EE-1F1F7/-->
					<span id="channelMine" style="flex: auto; line-height: 30px; text-align: center; border-radius: 20px 0px 0px 20px; background-color: transparent; opacity: 0.5;" onclick="switchLanguageChannel(extralang)">FAS</span>
					<span id="channelTu" style="flex: auto; line-height: 30px; text-align: center; border-radius: 20px 0px 0px 20px; background-color: transparent; opacity: 1;" onclick="switchLanguageChannel('tr')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" style="height: 20px; display: inline; top: 5px; position: relative;"><path fill="#d22f27" d="M5 17h62v38H5z"/><g fill="#fff" stroke="#fff" stroke-linejoin="round"><path stroke-linecap="round" d="M40.64 33.05l3.052 4.019-4.934-1.532 4.932-1.541-3.046 4.025-.004-4.972"/><path d="M31.29 44.64a8.643 8.643 0 1 1 3.958-16.34 11 11 0 1 0 0 15.38 8.715 8.715 0 0 1-3.958.951z"/></g><path fill="none" stroke="#000" stroke-linejoin="round" stroke-width="2" d="M5 17h62v38H5z"/></svg>TÃœ</span>
					<span id="channelEn" style="flex: auto; line-height: 30px; text-align: center; border-radius: 0px 20px 20px 0px; background-color: transparent; opacity: 0.5;" onclick="switchLanguageChannel('en')"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72 72" style="height: 20px; display: inline; top: 5px; position: relative;"><path fill="#1e50a0" d="M5 17h62v38H5z"/><path fill="#fff" d="M40 28.856V32h10.181L67 21.691V17h-7.654L40 28.856z"/><path fill="#d22f27" d="M67 17h0-3.827L40 31.203V32h3.482L67 17.586V17z"/><path fill="#fff" d="M59.347 55H67h0v-4.692L50.182 40H40v3.143L59.347 55z"/><path fill="#d22f27" d="M67 55v-2.347L46.355 40h-4.787l24.474 15H67h0z"/><path fill="#fff" d="M32 43.144V40H21.819L5 50.309V55h7.654L32 43.144z"/><path fill="#d22f27" d="M5 55h0 3.827L32 40.797V40h-3.482L5 54.414V55z"/><path fill="#fff" d="M12.653 17H5h0v4.692L21.818 32H32v-3.143L12.653 17z"/><path fill="#d22f27" d="M5 17v2.347L25.646 32h4.786L5.958 17H5h0z"/><g fill="#fff"><path d="M5 31h62v10H5z"/><path d="M31 17h10v38H31z"/></g><g fill="#d22f27"><path d="M5 33h62v6H5z"/><path d="M33 17h6v38h-6z"/></g><path fill="none" stroke="#000" stroke-linejoin="round" stroke-width="2" d="M5 17h62v38H5z"/></svg>EN</span>
					<span id="channelTooltip" class="tooltip" onmouseleave="this.click();" onclick="this.style.opacity = '0'; setTimeout(() => { this.style.display = 'none'; }, 200);">Change channel:</span>
				</div>
				<div id="onlinepanel" noselect> <p id="onlineCounter">...</p> <svg id="playerIcon" stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg" style="display: inline;"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></svg> </div>
				<icon-close noselect="" id="close-btn" onclick="messageInput.blur(); chatPanel.classList.remove('open')" class="active" style="flex: initial;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="active"><path d="M18.442 2.442l-.884-.884L10 9.116 2.442 1.558l-.884.884L9.116 10l-7.558 7.558.884.884L10 10.884l7.558 7.558.884-.884L10.884 10l7.558-7.558z" class=""></path></svg></icon-close>
			</div>
			<div id="chatContext" class="contextMenu" style="display:none">
				<ul>
					<li><a onclick="chatMentionUser(targetedUser); chatContext.style.display = 'none';">Mention user</a></li>
					<li><a onclick="blockUser(); chatContext.style.display = 'none'">Block user</a></li>
					<!--li onclick="chatContext.style.display = 'none'" style="pointer-events: none;"><a style="color: grey;">Open user channel</a></li-->
					<li onclick="namePanel.style.visibility='visible'; nameInput.value = targetedUser; chatContext.style.display = 'none'" style="display: none;"><a><em>Change my name</em></a></li>
				</ul>
			</div>
			<div id="chatMessages" style="overflow-wrap: break-word; word-wrap: break-word; font-family:mono;white-space: pre-wrap; max-height: calc(100% - 90px); overflow: auto; z-index: -1;"></div>
			<input id="messageInput" type="text" placeholder="Enter message..." enterkeyhint="send" maxlength="200">
		</div>
	</body>
	<script>
		let PALETTE = [0xff1a006d,0xff3900be,0xff0045ff,0xff00a8ff,0xff35d6ff,0xffb8f8ff,0xff68a300,0xff78cc00,0xff56ed7e,0xff6f7500,0xffaa9e00,0xffc0cc00,0xffa45024,0xffea9036,0xfff4e951,0xffc13a49,0xffff5c6a,0xffffb394,0xff9f1e81,0xffc04ab4,0xffffabe4,0xff7f10de,0xff8138ff,0xffaa99ff,0xff2f486d,0xff26699c,0xff70b4ff,0xff000000,0xff525251,0xff908d89,0xffd9d7d4,0xffffffff]
		let WIDTH = 2000
		let HEIGHT = 2000
		let COOLDOWN = 10e3
	</script>

	<script>
		const d1 = 'M8.44857 0.401443C8.3347 0.273284 8.17146 0.199951 8.00002 0.199951C7.82859 0.199951 7.66534 0.273284 7.55148 0.401443L0.351479 8.50544C0.194568 8.68206 0.155902 8.93431 0.252709 9.14981C0.349516 9.36532 0.563774 9.50395 0.800023 9.50395H4.20002V15C4.20002 15.3313 4.46865 15.6 4.80002 15.6H11.2C11.5314 15.6 11.8 15.3313 11.8 15V9.50395H15.2C15.4363 9.50395 15.6505 9.36532 15.7473 9.14981C15.8441 8.93431 15.8055 8.68206 15.6486 8.50544L8.44857 0.401443Z', d2 = 'm8 .200001c.17143 0 .33468.073332.44854.201491l7.19996 8.103998c.157.17662.1956.42887.0988.64437-.0968.21551-.3111.35414-.5473.35414h-3.4v5.496c0 .3314-.2686.6-.6.6h-6.4c-.33137 0-.6-.2686-.6-.6v-5.496h-3.4c-.236249 0-.450507-.13863-.547314-.35414-.096807-.2155-.058141-.46775.09877-.64437l7.200004-8.103998c.11386-.128159.27711-.201491.44854-.201491zm-5.86433 8.103999h2.66433c.33137 0 .6.26863.6.6v5.496h5.2v-5.496c0-.33137.2686-.6.6-.6h2.6643l-5.8643-6.60063'
		let i = +localStorage.vote
		for(const el of more.children)el.insertAdjacentHTML('afterbegin', `<up onclick="event.stopPropagation()"><svg ${i&1?'style="fill:#ff4500" ':''}height="24" viewBox="0 0 16 16" width="24" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="${i&1?d1:d2}" fill-rule="evenodd"></path></svg><div>...</div></up>`),i>>=1
		let touch1 = null, touch2 = null, touchmoved = 3;
		document.body.ontouchstart = function(e){
			for(let t of e.changedTouches){
				if(!touch1)touch1 = t, touchmoved = 3
				else if(!touch2)touch2 = t
				else [touch1, touch2] = [touch2, t]
			}
		}
		let moved = 3
		document.body.onmousedown = function(e){
			moved = 3
			click = e.button + 1
		}
		document.onmouseup = function(e){
			if(e.target != maincontent && !canvparent2.contains(e.target))return (moved = 3, click = 0)
			if(moved > 0 && canvparent2.contains(e.target)){
				clicked(e.clientX, e.clientY)
			}
			moved = 3
			click = 0
		}

		let arrowkeyDown = false
		document.body.onkeydown = function(e) {
			if (e.keyCode == 37 || e.keyCode == 38 || e.keyCode == 39 || e.keyCode == 40) {
				arrowkeyDown = true //we say, yeah, it is down
				setTimeout(function() {
					//if it is STILL down after 500ms, and hasn't been cancelled by document body onkeyup (released arrow key), we may continue.
					if (!arrowkeyDown) return 
					let repeatFunc = setInterval(function() {
						let match = true
						let x0 = x, y0 = y
						switch (e.keyCode) {
							case 37: x0 -= 1; break //right
							case 38: y0 -= 1; break //up
							case 39: x0 += 1; break //left
							case 40: y0 += 1; break //down
							default: match = false; return
						}
						//If cancelled while we are moving, then stop moving immediately.
						if (!arrowkeyDown) {clearInterval(repeatFunc); return}
						//commit changes to position
						x = x0
						y = y0
						pos()
					}, 100)
				}, 500)
			}
		}

		document.body.onkeyup = function(e) {
			let i = 10
			let repeatFunc = setInterval(function() {
				let match = true
				switch (e.keyCode) { //We use 55 because: 10/55+9/55+8/55+7/55+6/55+5/55+4/55+3/55+2/55+1/55 == 1
					case 37: x -= i / 55; break //right
					case 38: y -= i / 55; break //up
					case 39: x += i / 55; break //left
					case 40: y += i / 55; break //down
					default: match = false
				}
				if (match) arrowkeyDown = false;
				pos()
				i--
				if(i <= 0) clearInterval(repeatFunc)
			}, 16)
		}
		oncontextmenu = e => e.preventDefault()
		let selX = 0, selY = 0
		let c = canvas.getContext('2d')
		function transform(){
			canvparent1.style.transform = canvparent2.style.transform = "translate("+(x*z*-50+innerWidth/2)+"px, "+(y*z*-50+maincontent.offsetHeight/2)+"px) scale("+z*50+")"
			canvselect.style.transform = "translate("+Math.floor(x)+"px, "+Math.floor(y)+"px) scale(0.01)"
			canvas.style.width = z * canvas.width * 50 + "px"
			canvas.style.height = z * canvas.height * 50 + "px"
			canvas.style.transform = "translate("+x*z*-50+"px, "+y*z*-50+"px)"
			canvas.style.imageRendering = z < 1/50/devicePixelRatio ? "initial" : ""
		}
		let x, y, z, board, minZoom;
		let waitingGame = {
			canvas: document.getElementById("waitingGameCanvas"),
			start: function() {
				this.canvas.width = innerWidth
				this.canvas.height = innerHeight
				this.context = this.canvas.getContext("2d")
				this.interval = setInterval(updateGameArea, 14)
			},
			stop: function() {
				clearInterval(this.interval)
				physicsCubes = []
				this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)
			},
			clear: function() { this.context.clearRect(0, 0, this.canvas.width, this.canvas.height) }
		}
		function setsize(w, h = w){
			canvas.width = WIDTH = w
			canvas.height = HEIGHT = h
			canvparent1.style.width = w + "px"
			canvparent1.style.height = h + "px"
			canvparent2.style.width = w + "px"
			canvparent2.style.height = h + "px"
			board = new Uint8Array(w * h).fill(255)
			let i = board.length
			x = +localStorage.x || WIDTH/2
			y = +localStorage.y || HEIGHT/2
			z = +localStorage.z || 0.2
			for(let [k, v] of new URLSearchParams(location.search)){
				v *= 1; if(v != v)continue
				switch(k){
					case 'x': x = v; break
					case 'y': y = v; break
					case 'z': z = v; break
					case 'err': onerror = alert; break
					case 'debug': break
				}
			}
			onresize()
		}
		onresize = function(){
			minZoom = Math.min(innerWidth / canvas.width, maincontent.offsetHeight / canvas.height) / 100
			pos()
			waitingGame.canvas.width = innerWidth
      waitingGame.canvas.height = maincontent.offsetHeight
		}
		let click = false
		let mx = 0, my = 0;
		document.body.onmousemove = function(e){
			if(e.target != maincontent && !canvparent2.contains(e.target))return
			moved--
			let dx = -(mx - (mx = e.clientX - innerWidth / 2))
			let dy = -(my - (my = e.clientY - maincontent.offsetHeight / 2))
			if(dx != dx || dy != dy)return
			if(click){
				x -= dx / (z * 50)
				y -= dy / (z * 50)
				pos()
				clearInterval(anim)
			}
		}
		document.body.onwheel = function(e){
			if(e.target != maincontent && !canvparent2.contains(e.target))return
			let d = Math.max(minZoom / z, Math.min(3 ** Math.max(-0.5, Math.min(0.5, e.deltaY * -0.01)), 1 / z))
			z *= d
			x += mx * (d - 1) / z / 50
			y += my * (d - 1) / z / 50
			pos()
		}
		function pos(){
			if(z < minZoom)z = minZoom
			if(z > 1)z = 1
			let right = x - canvas.width + 0.01
			let left = x
			let up = y - canvas.height + 0.01
			let down = y
			if(right >= left) x = 0
			else if(right > 0) x -= right
			else if(left < 0) x -= left
			if(up >= down) y = 0
			else if(up > 0) y -= up
			else if(down < 0) y -= down
			posel.textContent = `(${Math.floor(x)},${Math.floor(y)}) ${z > 0.02 ? Math.round(z*50)/10 : Math.ceil(z*500)/100}x`
			localStorage.x = Math.floor(x) + 0.5
			localStorage.y = Math.floor(y) + 0.5
			localStorage.z = z
			transform()
		}
		function renderAll(){
			let img = new ImageData(canvas.width, canvas.height)
			let data = new Uint32Array(img.data.buffer)
			let len = board.length
			for(let i = 0; i < len; i++){
				data[i] = PALETTE[board[i]]
			}
			c.putImageData(img, 0, 0)
		}
		let xa = new Uint32Array(1)
		let xb = new Uint8Array(xa.buffer)
		function set(x, y, b){
			board[x % canvas.width + (y % canvas.height) * canvas.width] = b
			xa[0] = PALETTE[b]
			c.fillStyle = "#" + (xb[0] < 16 ? "0" : "") + xb[0].toString(16) + (xb[1] < 16 ? "0" : "") + xb[1].toString(16) + (xb[2] < 16 ? "0" : "") + xb[2].toString(16) + (xb[3] < 16 ? "0" : "") + xb[3].toString(16)
			c.clearRect(x,y,1,1)
			c.fillRect(x,y,1,1)
		}

		document.body.ontouchmove = e => {touchmoved--;for(let t of e.changedTouches){
			clearInterval(anim)
			a: if(!touch2 && touch1 && touch1.identifier == t.identifier){
				if(e.target != maincontent && !canvparent2.contains(e.target))break a
				x -= (t.clientX - touch1.clientX) / (z * 50)
				y -= (t.clientY - touch1.clientY) / (z * 50)
				pos()
			}else if(touch1 && touch2){
				if(e.target != maincontent && !canvparent2.contains(e.target))break a
				let touch = touch1.identifier == t.identifier ? touch1 : (touch2.identifier == t.identifier ? touch2 : null)
				if(!touch)break a
				let other = touch == touch1 ? touch2 : touch1
				x -= (t.clientX - touch.clientX) / (z * 50)
				y -= (t.clientY - touch.clientY) / (z * 50)
				let dx = touch.clientX - other.clientX
				let dy = touch.clientY - other.clientY
				let a = dx * dx + dy * dy
				dx = t.clientX - other.clientX
				dy = t.clientY - other.clientY
				a = Math.sqrt((dx * dx + dy * dy) / a)
				z *= a
				pos()
			}
			if(touch1 && touch1.identifier == t.identifier)touch1 = t
			else if(touch2 && touch2.identifier == t.identifier)touch2 = t
		}}

		setsize(WIDTH, HEIGHT)
		renderAll()
		let anim = null
		function clicked(clientX, clientY){
			clearInterval(anim)
			clientX = Math.floor(x+(clientX-innerWidth/2)/z/50) + 0.5
			clientY = Math.floor(y+(clientY-maincontent.offsetHeight/2)/z/50) + 0.5
			if(clientX == Math.floor(x) + 0.5 && clientY == Math.floor(y) + 0.5){
				clientX -= 0.5; clientY -= 0.5
				if(CD<Date.now())zoomIn(),showPalette()
				else audios.invalid.run()
				return
			}
			(CD > Date.now() ? audios.invalid : audios.highlight).run()
			anim = setInterval(function(){
				x += (clientX - x) / 10
				y += (clientY - y) / 10
				pos()
				if(Math.abs(clientX - x) + Math.abs(clientY - y) < 0.1)clearInterval(anim)
			},15)
		}
		function zoomIn(){
			if(z >= 0.4)return
			clearInterval(anim)
			let dz = 0.005
			anim = setInterval(function(){
				if(dz < 0.2)dz *= 1.1
				z *= 1 + dz
				pos()
				if(z >= 0.4)clearInterval(anim)
			}, 15)
		}
		let audios = {
			invalid: new Audio('https://hot-potato.reddit.com/media/interactions/invalid.mp3'),
			highlight: new Audio('https://hot-potato.reddit.com/media/interactions/highlight.mp3'),
			selectColor: new Audio('https://hot-potato.reddit.com/media/interactions/select-color.mp3'),
			closePalette: new Audio('https://hot-potato.reddit.com/media/interactions/close-pallette.mp3'),
			cooldownStart: new Audio('https://hot-potato.reddit.com/media/interactions/cooldown-start.mp3'),
			cooldownEnd: new Audio('https://hot-potato.reddit.com/media/interactions/cooldown-end.mp3')
		}
		HTMLAudioElement.prototype.run = Audio.prototype.run = async function(){
			if(muted)return
			this.currentTime = 0
			this.play().catch(e=>e)
		}
		let muted = !!+localStorage.muted, unmutedhtml = '<path d="M10.543.5a1.12 1.12 0 00-1.182.117L3.789 4.875h-1.8A1.127 1.127 0 00.868 6v8a1.127 1.127 0 001.125 1.125h1.8l5.572 4.258a1.117 1.117 0 00.681.232 1.128 1.128 0 001.127-1.126V1.511A1.119 1.119 0 0010.543.5zm-.624 17.736l-5.708-4.361H2.118v-7.75h2.093l5.708-4.361zM13 3.375v1.25a5.375 5.375 0 010 10.75v1.25a6.625 6.625 0 000-13.25z"></path><path d="M16.125 10A3.129 3.129 0 0013 6.875v1.25a1.875 1.875 0 010 3.75v1.25A3.129 3.129 0 0016.125 10z"></path>', mutedhtml = '<path d="M19.442 7.442l-.884-.884L16.5 8.616l-2.058-2.058-.884.884L15.616 9.5l-2.058 2.058.884.884 2.058-2.058 2.058 2.058.884-.884L17.384 9.5l2.058-2.058zM10.543.5a1.12 1.12 0 00-1.182.117L3.789 4.875h-1.8A1.127 1.127 0 00.868 6v8a1.127 1.127 0 001.125 1.125h1.8l5.572 4.258a1.117 1.117 0 00.681.232 1.128 1.128 0 001.127-1.126V1.511A1.119 1.119 0 0010.543.5zm-.624 17.736l-5.708-4.361H2.118v-7.75h2.093l5.708-4.361z"></path>'
		mutesvg.innerHTML=muted?mutedhtml:unmutedhtml
		let CD = Infinity
		let onCooldown = false
		setInterval(() => {
			let left = Math.floor((CD - Date.now()) / 1000)
			place.innerHTML = (CD >= 1e100 ? (CD == Infinity ? 'Connecting...' : '<span style="color:#f50">Could not connect!</span>') : left > 0 ? `<svg xmlns="http://www.w3.org/2000/svg" data-name="icons final" viewBox="0 0 20 20" style="height: 1.1rem;vertical-align:top"><path d="M13.558 14.442l-4.183-4.183V4h1.25v5.741l3.817 3.817-.884.884z"></path><path d="M10 19.625A9.625 9.625 0 1119.625 10 9.636 9.636 0 0110 19.625zm0-18A8.375 8.375 0 1018.375 10 8.384 8.384 0 0010 1.625z"></path></svg> ${(''+Math.floor(left/3600)).padStart(2,"0")}:${(''+Math.floor((left/60))%60).padStart(2,"0")}:${(''+left%60).padStart(2,"0")}` : "Place a tile")
			if(CD > Date.now() && !onCooldown)onCooldown = true
			if(CD < Date.now() && onCooldown){
				onCooldown = false
				if (!document.hasFocus()) audios.cooldownEnd.run()
			}
		}, 300)

		function showPalette(){
			palette.style.transform = ""
			audios.highlight.run()
		}
		let PEN = -1
		colors.innerHTML = PALETTE.map((a,i)=>`<div style='background:rgba(${a&255},${(a>>8)&255},${(a>>16)&255},1)${a==0xffffffff?";outline:1px #ddd solid;outline-offset:-1px":""}'><span style="background-color: rgba(255, 255, 255, 0.2); border-radius: 20px; width: 15px; height: 15px; position: absolute; text-align: center; line-height: 1; visibility: hidden;"></span></div>`).join('')
		colors.onclick = function(e){
			let i = [...this.children].indexOf(e.target)
			if(i<0)return
			let el = this.children[PEN]
			if(el){
				el.classList.remove('sel')
			}
			PEN = i
			canvselect.style.background = e.target.style.background
			e.target.classList.add('sel')
			pok.classList.add('enabled')
			canvselect.children[0].style.display='none';canvselect.style.outline='8px white solid';canvselect.style.boxShadow='0px 2px 4px 0px rgb(0 0 0 / 50%)'
			hideIndicators()
			audios.selectColor.run()
		}
		function runLengthChanges(data, a){
			let i = 9, boardI = 0
			waitingGame.start()
			let w = data.getUint32(1), h = data.getUint32(5)
			if(w != WIDTH || h != HEIGHT)setsize(w, h)
			board = new Uint8Array(a)
			while(i < data.byteLength){
				let cell = data.getUint8(i++)
				let c = cell >> 6
				if(c == 1)c = data.getUint8(i++)
				else if(c == 2)c = data.getUint16(i++),i++
				else if(c == 3)c = data.getUint32(i++),i+=3
				boardI += c
				board[boardI++] = cell & 63
			}
			renderAll()
			loadingScreen.style.opacity = 0
			setTimeout(()=>loadingScreen.remove(),300)
			setTimeout(()=>waitingGame.stop(),300)
		}
		let load = false
		fetch(localStorage.board || 'place').then(a=>a.arrayBuffer()).then(a => {
			if(load) runLengthChanges(load, a)
			else load = a
		}).catch(e => {
			loadingScreen.children[0].src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAYAAACOEfKtAAAAAXNSR0IArs4c6QAAAddJREFUeF7tnFEOgyAUBOGQegQP5RG8pA0fNIRohUxTQ53+tbKmTPftEzGN0zTt4cGvbdvQ7KMABYgcpAMRvhAEKEBIAMp1oAAhASjXgQKEBKBcBwoQEoByHShASADKdaAAIQEov92B9AvA+WP5PM/oHPh+oADhHWkBCtASJgTMQEIvhCBAAUICUK4DBQgJQLkOFCAkAOU6UICQAJTrQAFCAlA+vAPXdUUIlmVBegEKUAeiErKE4TPGAhQge0qf7onoQB2oA0kXvH1f2BK2hC1hSxgQcC3sWti1MCigEOzCsAsj+l8QD5+BX2CATjEcwBjje8L7voez9+lYeqXjeVzL+F6aQwLMcEpAeeJHwGqAR/qsewTAPMnSUaXj0vErB56N/3uAZ0779HnprtpptWP/HmBLBpYlW5f5kb4e3wNxuAzsmdwvxg4DsMV5dTbWzaIlO8v8bPkBhgLY0k3rLCwhHGXhYzLw7Hruqvv2AOx1XxqvA6sL7ZayLccMBfAq41oyL7vsaoXSCnIYgK0T+vU4AULiAnw6QOoAyA/Lb98XFiC8Iy1AAd67sa4DdaAOJK3YLkzopU0v+jfI9AlVM9AMNANJFVvChJ4ZCOkJUICcADyDGQgBvgBxwKKvpzakwAAAAABJRU5ErkJggg"
			waitingGame.start()
		})
		const CHAT_COLOURS = ["lightblue", "navy", "green", "purple", "grey", "brown", "orangered", "gold"]
		let online = 1
		let hash = a => a.split("").reduce((a,b)=>(a*31+b.charCodeAt())>>>0,0)
		let allowed = new Set("rplace.tk google.com wikipedia.org pxls.space".split(" ")), censor = a => a.replace(/sik[ey]im|orospu|piÃ§|yavÅŸak|amcÄ±k|fuc?k|shi[t]|c[u]nt|nigg[ae]r?/gi,a=>"*".repeat(a.length)).replace(/https?:\/\/(\w+\.)+\w{2,15}(\/\S*)?|(\w+\.)+\w{2,15}\/\S*|(\w+\.)+(tk|ga|gg|gq|cf|ml|fun|xxx|webcam|sexy?|tube|cam|p[o]rn|adult|com|net|org|online|ru|co|info|link)/gi, a => allowed.has(a.replace(/^https?:\/\//,"").split("/")[0]) ? a : "").trim()
		const lang = navigator.language.split('-')[0]
		let extralang = 'fa'
		if(lang != 'tr' && lang != 'en'){
			extralang = lang
			channelMine.innerText = extralang.toUpperCase()
		}
		let cMessages = {[extralang]: [], tr: [], en: []}
		let currentChannel = lang
		switchLanguageChannel(currentChannel)
		wscapsule()
		function seti(i, b){
			board[i] = b
			xa[0] = PALETTE[b]
			c.fillStyle = "#" + (xb[0] < 16 ? "0" : "") + xb[0].toString(16) + (xb[1] < 16 ? "0" : "") + xb[1].toString(16) + (xb[2] < 16 ? "0" : "") + xb[2].toString(16) + (xb[3] < 16 ? "0" : "") + xb[3].toString(16)
			c.fillRect(i % WIDTH, Math.floor(i / WIDTH), 1, 1)
		}
		function hideIndicators() {
			for (let c = 0; c < document.getElementById("colors").children.length; c++) {
				document.getElementById("colors").children[c].firstChild.style.visibility = "hidden"
			}
		}
		for (let c = 0; c < document.getElementById("colors").children.length; c++) {
			let keybinds = "123456789abcdefghijklmnopqrstuvwxyz"
			let indicator = document.getElementById("colors").children[c].firstChild
			indicator.textContent = keybinds.charAt(c)
		}
		let encoder = new TextEncoder(), decoder = new TextDecoder()
		if (localStorage.name) {
			namePanel.style.visibility = "hidden"
		}
		function setName(name) {
			localStorage.name = name
			namePanel.style.visibility = "hidden"
		}
		
		function switchLanguageChannel(selected) {
			channelTu.style.opacity = "0.5"
			channelMine.style.opacity = "0.5"
			channelEn.style.opacity = "0.5"
			currentChannel = selected
			chatMessages.style.direction =  "ltr";
			switch(selected) {
				case "tr":
					channelTu.style.opacity = "1"
					break;
				case "en":
					channelEn.style.opacity = "1"
					break;
				default:
					channelMine.style.opacity = "1"
					chatMessages.style.direction = '';
			}
			chatMessages.innerHTML=''; for(const el of cMessages[selected])chatMessages.appendChild(el)
		}

		function chatMentionUser(user) {
			messageInput.focus()
			let [start, end] = [messageInput.selectionStart, messageInput.selectionEnd]
			messageInput.setRangeText("@" + user, start, end, "end")
		}
		const emojiMap = {
	  	joy: "ðŸ˜‚", cool: "ðŸ˜Ž", sunglasses: "ðŸ˜Ž", heart: "â¤ï¸", moyai: "ðŸ—¿", bruh: "ðŸ—¿", turkey: "ðŸ‡¹ðŸ‡·", skull: "ðŸ’€", amongus: "à¶ž", sus: "à¶ž", iran: "ðŸ‡®ðŸ‡·", uk: "ðŸ‡¬ðŸ‡§", usa: "ðŸ‡ºðŸ‡¸"
		}
		messageInput.oninput = () => {
			messageInput.style.color = (messageInput.value.includes(":") ? "#00FA9A" : "black")

			for (const [emojiCode, value] of Object.entries(emojiMap)) {
				if (messageInput.value.includes(":"+emojiCode+":")) {
					messageInput.value = messageInput.value.replace(":"+emojiCode+":", value)
					messageInput.style.color =  "black"
				}
			}
		}

		function chatReplyMessage(message) {
			console.log(message)
		}

		function switchGameServer(serverAddress) {
			if(serverAddress){
				let [a, b] = serverAddress.split(" ").reverse()
				if(!b)[b,a]=[a+'/place','server.'+a]
				a = "wss://" + a
				b = "https://" + b
				server(a, b)
			}else{
				delete localStorage.board
				delete localStorage.server
			}
			location+=''
		}
		
		//Thanks to (Discord) @carkan988"<%#1409, @anonimbiri#4089 for providing turkish translations, and @sorenaxmee#4191 and @rplacetk telegram contributors for persian translations, a big thanks (ig) to Cyart#9657 for romanian, greek and spanish translations, thanks to embed#2752 for french translation.
		const TRANSLATIONS_FAS = { "Connecting...": "Ø¯Ø± Ø­Ø§Ù„ ÙˆØµÙ„ Ø´Ø¯Ù†", "Could not connect!": "Ù…ØªØµÙ„ Ù†Ø´Ø¯", "Downloading image...": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø²Ø§Ø±ÛŒ Ø¹Ú©Ø³ Ù‡Ø§", "Place a tile": "Ù†Ù‚Ø§Ø´ÛŒ Ú©Ø±Ø¯Ù†", "Donate": "Ø­Ù…Ø§ÛŒØª", "Chat": "Ú†Øª", "Live Chat:": "Ú†Øª Ø²Ù†Ø¯Ù‡", "Enter a nickname to continue:": "Ù„Ø·ÙØ§ Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ú†Øª Ú©Ø±Ø¯Ù† ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯", "Change channel:": "ØªØºÛŒÛŒØ± Ú©Ø§Ù†Ø§Ù„:", "<kbd>Shift</kbd>+<kbd>O</kbd> overlay menu": "Ù…Ù†ÙˆÛŒ Ù‡Ù…Ù¾ÙˆØ´Ø§Ù†ÛŒ <kbd>Shift</kbd>+<kbd>O</kbd>ØŒ Ù…Ù†ÙˆÛŒ Ø³ÙˆØ¦ÛŒÚ† Ø³Ø±ÙˆØ± <kbd>Shift</kbd>+<kbd>S</kbd>." }
		const TRANSLATIONS_TK = { "Connecting...": "BaÄŸlanÄ±yor...", "Could not connect!": "BaÄŸlanamadÄ±!", "Downloading image...": "Resim indiriliyor...", "Place a tile": "Bir karo yerleÅŸtir", "Donate": "BaÄŸÄ±ÅŸ yap", "Chat": "Sohbet", "Live Chat:": "CanlÄ± sohbet:", "Enter a nickname to continue:": "Devam etmek iÃ§in bir takma ad girin:", "Change channel:": "KanalÄ± deÄŸiÅŸtir:", "<kbd>Shift</kbd>+<kbd>O</kbd> overlay menu": "<kbd>Shift</kbd>+<kbd>O</kbd> bindirme menÃ¼sÃ¼, <kbd>Shift</kbd>+<kbd>S</kbd> sunucu deÄŸiÅŸtirme menÃ¼sÃ¼.", "Please click the button containing the emoji you see below": "LÃ¼tfen aÅŸaÄŸÄ±da gÃ¶rdÃ¼ÄŸÃ¼nÃ¼z emojiyi iÃ§eren butona tÄ±klayÄ±n" }
		const TRANSLATIONS_ROM = { "Connecting...": "Se conecteazÄƒ...", "Could not connect!": "Nu s-a putut conecta!", "Downloading image...": "Se descarcÄƒ imaginea...", "Place a tile": "Pune un pixel", "Donate": "DoneazÄƒ", "Chat": "ConversaÈ›ii", "Live Chat:": "ConversaÈ›ii Ã®n direct:", "Enter a nickname to continue:": "Introdu un nume pentru a continua:", "Change channel:": "SchimbaÈ›i canalul:", "<kbd>Shift</kbd>+<kbd>O</kbd> overlay menu": "<kbd>Shift</kbd>+<kbd>O</kbd> meniu suprapus, <kbd>Shift</kbd>+<kbd>S</kbd> meniu de comutare server." }
		const TRANSLATIONS_GR = { "Connecting...": "Î£Ï…Î½Î´ÎµÏ„Î¹ÎºÏŒÏ‚...", "Could not connect!": "Î”ÎµÎ½ Î¼Ï€Î¿ÏÎ¿ÏÏƒÎµ Î½Î± ÏƒÏ…Î½Î´ÎµÎ¸ÎµÎ¯!", "Downloading image...": "Î›Î®ÏˆÎ· ÎµÎ¹ÎºÏŒÎ½Î±Ï‚...", "Place a tile": "Ï„Î¿Ï€Î¿Î¸ÎµÏ„ÏŽ Î­Î½Î± Ï€Î¯Î¾ÎµÎ»", "Donate": "Î´Î±Î½ÎµÎ¹ÏƒÏ‰", "Chat": "ÏƒÏ…Î¶Î®Ï„Î·ÏƒÎ·", "Live Chat:": "Î¶Ï‰Î½Ï„Î±Î½Î® ÏƒÏ…Î¶Î®Ï„Î·ÏƒÎ·", "Enter a nickname to continue:": "Î•Î¹ÏƒÎ±Î³Î¬Î³ÎµÏ„Îµ Î­Î½Î± ÏˆÎµÏ…Î´ÏŽÎ½Ï…Î¼Î¿ Î³Î¹Î± Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÏ„Îµ:", "Change channel:": "Î‘Î»Î»Î±Î³Î® ÎºÎ±Î½Î±Î»Î¹Î¿Ï:", "<kbd>Shift</kbd>+<kbd>O</kbd> overlay menu": "ÎœÎµÎ½Î¿Ï ÎµÏ€Î¹ÎºÎ¬Î»Ï…ÏˆÎ·Ï‚ <kbd>Shift</kbd>+<kbd>O</kbd>, Î¼ÎµÎ½Î¿Ï ÎµÎ½Î±Î»Î»Î±Î³Î®Ï‚ Î´Î¹Î±ÎºÎ¿Î¼Î¹ÏƒÏ„Î® <kbd>Shift</kbd>+<kbd>S</kbd>." }
		const TRANSLATIONS_SP = { "Connecting...": "Conectando...", "Could not connect!": "Â¡No podÃ­a conectar!", "Downloading image...": "Descargando imagen...", "Place a tile": "Coloca un pixel", "Donate": "Donar", "Chat": "Chat", "Live Chat:": "Chat en vivo:", "Enter a nickname to continue:": "Introduce un apodo para continuar:", "Change channel:": "Cambia el canal:", "<kbd>Shift</kbd>+<kbd>O</kbd> overlay menu": "<kbd>Shift</kbd>+<kbd>O</kbd> menÃº superpuesto, <kbd>Shift</kbd>+<kbd>S</kbd> menÃº de cambio de servidor." }
		const TRANSLATIONS_FR = { "Connecting...": "De liaison...", "Could not connect!": "Impossible de se connecter!", "Downloading image...": "TÃ©lÃ©charger l'image...", "Place a tile": "Place un pixel", "Donate": "Faire un don", "Chat": "Discuter", "Live Chat:": "Chat en direct:", "Enter a nickname to continue:": "Entrez un surnom pour continuer :", "Change channel:": "Changer de chaÃ®ne:", "<kbd>Shift</kbd>+<kbd>O</kbd> overlay menu": "<kbd>Shift</kbd>+<kbd>O</kbd> menu superposÃ©, <kbd>Shift</kbd>+<kbd>S</kbd> menu de changement de serveur." }
		function translate(elementArray) {
			elementArray.forEach(element => {
				let key = element.innerHTML
				switch(navigator.language.split('-')[0]) {
					case "fa": element.innerHTML = TRANSLATIONS_FAS[key] //persian
					case "tr": element.innerHTML = TRANSLATIONS_TK[key] //turkish
					case "ro": element.innerHTML = TRANSLATIONS_ROM[key] //romanian
					case "el": element.innerHTML = TRANSLATIONS_GR[key] //greek
					case "es": element.innerHTML = TRANSLATIONS_SP[key] //spanish
					case "fr": element.innerHTML = TRANSLATIONS_FR[key] //french
					default: element.innerHTML = key
				}
			})
		}
		translate([liveChatHeader, namePanelHeader, channelTooltip, captchaLabel])


		function component(width, height, colour, x, y, type, falling) {
			this.type = type
			this.width = width
			this.height = height
			this.x = x
			this.y = y
			this.speedX = 0
			this.speedY = 0
			this.gravity = 0.12
			this.gravitySpeed = 0

			this.update = function () {
				//gravity calculations
				this.gravitySpeed += this.gravity
				this.y += (waitingGame.canvas.height - this.y > 30) ? (this.speedY + this.gravitySpeed):0
				this.x += this.speedX
				//floor
				var floor = waitingGame.canvas.height - this.height
				if (this.y > floor) {
					this.y = floor
					this.speedY = 0
					this.gravitySpeed = 0
				}
				//grid snap
				this.x = Math.floor(this.x / this.width) * this.width
				//overlapping
				physicsCubes.forEach(other => {
					if (other != this) {
						let calcH = (this.height + other.height) / 2, calcW = (this.width + other.width)/2
						if (Math.abs(this.y - other.y) < calcH && Math.abs(other.x - this.x) < calcW) { //Colliding
							this.speedY = 0
							this.gravitySpeed = 0
							this.y = (other.y - other.height) - 0.01
						}
					}
				})
				//render update
				ctx = waitingGame.context
				ctx.fillStyle = colour
				ctx.fillRect(this.x, this.y, this.width, this.height)
			}
		}
		function updateGameArea() {
			waitingGame.clear()
			physicsCubes.forEach(cube => { cube.update() })
		}
		waitingGame.canvas.onmousedown = function(e) {
			physicsCubes.push(new component(80, 80, ["grey", "lightgray", "darkgray", "whiteSmoke"][Math.floor(Math.random() * 4)], Math.floor(e.x), Math.floor(e.y)))
		}
		let physicsCubes = []
		waitingGame.start()

		let archiveViewDragging = false
		let archiveViewZoom = 500;
		function archiveViewMouseMove(e) {
			if (archiveViewDragging) {
				let dx = archiveViewImg.style.objectPosition.split(" ")[0].slice(0, -2), dy = archiveViewImg.style.objectPosition.split(" ")[1].slice(0, -2)
				archiveViewImg.style.objectPosition = `${e.offsetX - dx}px ${e.offsetY - dy}px`
			}
		}
		function archiveViewWheel() {
			archiveViewZoom += 1
			archiveViewImg.style.transform = `scale(${archiveViewZoom}%)`
			console.log(archiveViewZoom)
		}
		function closeOverlayMenu() {
			overlayMenu.style.transform = "translateX(-50%) translateY(-330px)"
			overlayMenu.opened = false
		}
		function openOverlayMenu() {
			overlayMenu.style.transform = serverMenu.opened ? "translateX(-50%) translateY(110px)"  : "translateX(-50%)"
			overlayMenu.opened = true
		}

		let overlayInfo = {x: 0, y: 0, w: 0, h: 0, opacity: 0.8} //TODO: Useless var, replace with direct access
		overlayInput.onchange = () => {
			if (!overlayInput.files || !overlayInput.files[0]) return
			templateImage.src = URL.createObjectURL(overlayInput.files[0])
			templateImage.style.transform = `translate(${overlayInfo.x}px ${overlayInfo.y}px)`
			templateImage.style.opacity = 0.8
			generateOverlayUrl()
		}
		overlayX.onchange = () => {
			overlayInfo.x = Number(overlayX.value)
			templateImage.style.left = overlayInfo.x+"px"
			generateOverlayUrl()
		}
		overlayY.onchange = () => {
			overlayInfo.y = Number(overlayY.value)
			templateImage.style.top = overlayInfo.y+"px"
			generateOverlayUrl()
		}
		overlayOpacity.onchange = () => {
			overlayInfo.opacity = Number(overlayOpacity.value)/100
			templateImage.style.opacity = overlayInfo.opacity
			generateOverlayUrl()
		}
//TODO: Finish this
		function generateOverlayUrl() {
			history.replaceState({}, "", `https://rplace.tk/?ox=${overlayInfo.x},oy=${overlayInfo.y},ow=${overlayInfo.width},oh=${overlayInfo.h},oo=${overlayInfo.opacity},oi=${URL.createObjectURL(overlayInput.files[0])}`)
		}
		
		let blockedUsers = [], targetedUser
		function blockUser() {
			blockedUsers.push(targetedUser)
		}
		function onChatContext(e, uname) {
			e.preventDefault()
	
			if (chatContext.style.display == "block")
				hideChatContext();
			else {
				targetedUser = uname
				chatContext.style.display = 'block'
				chatContext.children[0].children[0].children[0].textContent = "Mention " + uname
				if (uname === localStorage.name) {
					//Prevent user from self blocking.
					chatContext.children[0].children[1].style.pointerEvents = "none"
					chatContext.children[0].children[1].children[0].style.color = "grey"
					chatContext.children[0].children[1].children[0].innerHTML = "Block " + uname
					//Allow user to change their own name
					chatContext.children[0].children[2].style.display = ''
				}
				else {
					chatContext.children[0].children[1].style.pointerEvents = ''
					chatContext.children[0].children[1].children[0].style.color = ''
					chatContext.children[0].children[1].children[0].textContent = "Block " + uname
					//Allow user to change their own name
					chatContext.children[0].children[2].style.display = "none"
				}
				chatContext.style.left = e.pageX - chatPanel.offsetLeft + "px"
				chatContext.style.top = e.pageY - chatPanel.offsetTop + "px"
			}
		}
		function hideChatContext() {
			chatContext.style.display = "none"
		}

		let redirectLocation = ({
			"?discord": "https://discord.com/invite/xbRrVSXJdZ",
			"?twitter": "https://twitter.com/rplacetk",
			"?reddit": "https://www.reddit.com/r/placetk",
			"?github": "https://github.com/rslashplace2",
			"?admin": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"
		})[location.search]
		if (redirectLocation) location.replace(redirectLocation)
		// The page is in an iframe, android webview or free app maker, we check it against an irreversable hash (verified app hash) to check if it is the real rplace.tk app or a fake clone
		if (location !== parent.location || typeof window.Android !== "undefined" || typeof window.Kodular !== "undefined")
			location.replace("fakeapp.html")
		setTimeout(() => window.connproblems&&(connproblems.style.opacity = 1), 5000)
		setTimeout(() => {
			channelTooltip.style.opacity = '0'; channelTooltip.style.display = 'none';
		}, 0);
		//if (window.location.href.startsWith("http://")) window.location.href = "https://rplace.tk"
		let server = (a,b,x='',l=localStorage)=>{if(!a){l.vip=l.vvip;delete l.vvip;delete l.server;delete l.board;return}l.vvip=l.vvip||l.vip;l.vip=x;l.server=a;l.board=b}
	</script>
</html>
